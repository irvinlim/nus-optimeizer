function moduleRemoveClickHandler(a){var b=$(a.target).unbind("click").parentsUntil("li").last().parent().attr("data-code");ModuleUtil.prototype.removeModule(b)}function populateScheduleClickHandler(a){var b=$(a.target).attr("data-index");TimetableUtil.prototype.populateSchedule(App.generatedSchedules[b],App.generatedScheduleVals[b])}function blockTableCellClickHandler(a){var b=$(a.target).prevAll(),c=0;b.each(function(a,b){return $(b).is("th")?!0:void(parseInt($(b).prop("colspan"))>1?c+=parseInt($(b).prop("colspan")):c++)});var d=$(a.target).parent().prevAll(),e=d.length,f=new Time(e,colIndexToTime(c),colIndexToTime(c+1));$(a.target).toggleClass("blocked"),TimetableUtil.prototype.toggleBlockedSlot(f)}function makeOptimizeClickHandler(a){getFiveBest()}function getCellInRow(a,b){var c=0,d=null;return a.find("td").each(function(a,e){return c==b?(d=$(e),!1):void(parseInt($(this).prop("colspan"))>1?c+=parseInt($(this).prop("colspan")):c++)}),d}function getPaletteIndex(a){return App.addedModules.indexOf(a)}function dayToRowIndex(a){return a}function timeToColIndex(a){var b=a%100/30;return 2*(Math.floor(a/100)-START_TIME_HR)+b}function colIndexToTime(a){var b=a%2;return 100*(Math.floor(a/2)+START_TIME_HR)+30*b}function actNameGetAbbr(a){var b={Laboratory:"LAB",Tutorial:"TUT",Lecture:"LEC","Sectional Teaching":"SEC",Seminar:"SEM",Recitation:"REC"};return b[a]}function makeBlock(a,b,c,d,e){var f='<div class="lesson_block palette-'+e+'" data-starttime="'+d.start+'" data-endtime="'+d.end+'" data-code="'+a.modCode+'" data-slotcode="'+c+'" data-activity="'+actNameGetAbbr(b)+'">\n	<span class="code">'+a.modCode+' </span>\n	<span class="activity_code">'+actNameGetAbbr(b)+" ["+c+'] </span>\n	<span class="venue">'+d.place+"</span>";return isArray(d.week)?f+='<span class="weeks">Weeks '+d.join(",")+"</span>":isNumber(d.week)&&d.week>0&&(f+='<span class="weeks">'+(1===d?"Odd":"Even")+" Week</span>"),f+="</div>"}function modCodeToNUSModsURL(a){return"https://nusmods.com/modules/"+a}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function isArray(a){return a instanceof Array}function toPercent(a){return 100*a+"%"}function Schedule(){this.courses=[],this.blocked=[]}function loadCourseFromJSON(a,b,c){var d=new Course;d.modName=a,d.modCode=b,d.activities=[];for(var e=0;e<c.length;e++){for(var f=!1,g=0;g<d.activities.length;g++)if(d.activities[g].name==c[e].LessonType){d.activities[g].addSlot(c[e]),f=!0;break}f||(d.activities.push(new Activity(c[e].LessonType)),d.activities[d.activities.length-1].addSlot(c[e]))}return d}function Course(){this.modName="",this.modCode="",this.activities=[]}function Activity(a){this.name=a,this.slots=[],this.curSlot=0}function Slot(a){this.code=a,this.timings=[]}function Time(a,b,c,d,e){this.day=a,this.start=b,this.end=c,this.place=d,this.week=e}function optimize(a,b,c){for(var d=[],e=[],f=0;f<a.length;f++)d.push(loadModData(a[f]));$.when.apply($,d).done(function(){for(var d=0,f=arguments,g=0;g<a.length;g++)e[g]=loadCourseFromJSON(App.moduleList[a[g]],a[g],f[g][0]);var h=new Schedule;h.blocked=b;for(var i=[h];d<e.length;){var j=e[d],k=i;i=[];for(var l=[],g=0;g<k.length;g++){j.reset();for(var m=!1;;){if(!k[g].overlap(j)){var n=k[g].clone();n.addCourse(j.clone()),i.push(n),m=!0}if(!j.hasNextSlot())break;j.nextSlot()}m||l.push(k[g])}0==i.length&&(i=l),console.log("solns.length"),console.log(i.length),i.length>5e3&&(i=shuffle(i).slice(-5e3)),++d}c(i)})}function shuffle(a){for(var b=a.length-1;b>=0;b--){var c=Math.floor(Math.random()*(b+1));if(c!=b){var d=a[c];a[c]=a[b],a[b]=d}}return a}function loadModData(a){return $.getJSON("http://api.nusmods.com/2015-2016/2/modules/"+a.toUpperCase()+"/timetable.json").fail(function(a){alert("Incorrect code")})}function showStringify(a){console.log(JSON.stringify(a))}function enterModData(){loadModData(document.getElementById("modulecode").value)}function test1(a){a="CS2020",loadModData(a).done(function(b){x=loadCourseFromJSON(App.moduleList[a],a,b)})}function test2(){for(var a="",b=0;b<x.activities.length;b++)console.log(x.activities[b]),a+=" : "+(x.activities[b].curSlot+1)+"/"+x.activities[b].slots.length;console.log(a),x.hasNextSlot()?(console.log("NEXT!"),x.nextSlot()):console.log("NO MORE!")}function optimizeChosenMods(a){for(var b=[],c=0;c<App.addedModules.length;c++)b.push(loadModData(App.addedModules[c]));$.when.apply($,b).done(function(){optimize(App.addedModules,App.blockedSlots,function(b){a(b)})})}function getFiveBest(){TimetableUtil.prototype.clearSchedules(),optimizeChosenMods(function(a){for(var b=[],c=0;c<a.length;c++)b[c]=getScheduleVal(a[c])[0];for(var c=0;5>c&&a.length>0;c++){for(var d=[-1,-(1/0)],e=0;e<b.length;e++)b[e]>d[1]&&(d=[e,b[e]]);var f=a[d[0]],g=getScheduleVal(f);TimetableUtil.prototype.addSchedule(f,g),b.splice(d[0],1),a.splice(d[0],1)}TimetableUtil.prototype.populateSchedule(App.generatedSchedules[0],App.generatedScheduleVals[0]),App.blockedSlots=[]})}function genDisplayTest(a){for(var b=(new Schedule,["CS2020","CS2100","MA1101R","ST2131","GER1000","CFG1010"]),c=[],d=0;d<b.length;d++)c.push(loadModData(b[d]));$.when.apply($,c).done(function(){optimize(b,[],function(b){a(b)})})}function getTimeDiff(a,b){return(60*Math.floor(b/100)+b%100-(60*Math.floor(a/100)+a%100))/30}function getLoc(a){for(var b=0;b<LOCS.length;b++)if(-1!=LOCS[b].indexOf(a))return LOCS[b]}function getScheduleVal(a){for(var b=[],c=0;c<a.courses.length;c++)for(var d=0;d<a.courses[c].activities.length;d++)for(var e=a.courses[c].activities[d],f=e.slots[e.curSlot],g=0;g<f.timings.length;g++)b.push(f.timings[g]);b.sort(function(a,b){return 2400*(a.day-b.day)+(a.start-b.start)});for(var h=-1,i=[-1,0,DUMMY],j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,c=0;c<b.length;c++){var r=b[c];r.day!=h&&(h=r.day,p-=Math.pow(getTimeDiff(k,l),2),k=0,l=r.start,n-=1e3);var s=getLoc(r.place);r.day!=i[0]||r.start!=i[1]?j=0:(console.log(s),-1==adjacency[s].indexOf(i[2])&&(q-=500));var t=Math.pow(j,3);o+=Math.pow(j,3),j+=getTimeDiff(r.start,r.end),t-=Math.pow(j,3),o-=Math.pow(j,3),k=r.end,i=[r.day,r.end,s]}p-=Math.pow(getTimeDiff(k,l),2);var m=n+o+p+q,u=o+p+q;o=1-o/u,q=1-q/u,p=1-p/u;var v=0;return-4e3==n?v=.5:n>-4e3&&(v=1),[m,v,o,p,q]}const START_TIME=800,START_TIME_HR=8,END_TIME=2200,END_TIME_HR=22,TIMETABLE_RANGE=14,TIMETABLE_DAYS_SHOWN=7,DAYS_OF_WEEK=["MON","TUE","WED","THU","FRI","SAT","SUN"];var SDE=["AKI3","AKI4A","AKI4B","AKI5A","AKI5B","AKIMAUD","AKIMLA4","AKIMLA5","DDL3-2","CELC-SR1A","CELC-TR7","CELS-01-06","CELS-01-08","SDE-421","SDE-422","SDE-423","SDE-424","SDE-425","SDE-426","SDE-427","SDE-CR1","SDE-CR4","SDE-DDL2-2","SDE-DV1","SDE-DV2","SDE-DV3","SDE-ER1","SDE-ER4","SDE-ER5","SDE-ES1","SDE-ES2","SDE-GIS","SDE-ISD-1","SDE-MEZZ","SDE-SR10","SDE-SR11","SDE-SR12","SDE-SR13","SDE-SR14","SDE-SR15","SDE-SR4","SDE-SR7","SDE-SR8","SDE-SR9"],AS=["AS-DV","AS1-0201","AS1-0203","AS1-0204","AS1-0205","AS1-0207","AS1-0208","AS1-0209","AS1-0210","AS1-0212","AS1-0213","AS1-0301","AS1-0302","AS1-0303","AS1-0304","AS1-0524","AS1-0548","AS2-0203","AS2-0204","AS2-0302","AS2-0311","AS2-0312","AS2-0313","AS2-0316","AS2-0413","AS2-0509","AS2-0510","AS3-0207","AS3-0208","AS3-0209","AS3-0212","AS3-0213","AS3-0214","AS3-0215","AS3-0302","AS3-0303","AS3-0304","AS3-0305","AS3-0306","AS3-0307","AS3-0308","AS3-0309","AS3-0523","AS3-0620","AS4-0109","AS4-0110","AS4-0114","AS4-0115","AS4-0116","AS4-0117","AS4-0118","AS4-0119","AS4-0206","AS4-0208","AS4-0306","AS4-0335","AS4-0601","AS4-0602","AS4-0603","AS4-0604","AS4-B107","AS4-B109","AS4-B110","AS5-0202","AS5-0203","AS5-0205","AS5-0309","AS6-0204","AS6-0205","AS6-0208","AS6-0212","AS6-0214","AS6-0215B","AS6-0333","AS6-0338","AS6-0421","AS6-0426","AS7-0101","AS7-0102","AS7-0106","AS7-0117","AS7-0119","AS7-0201A","AS7-0214","AS7-0411","AS7-0413","AS7-0642","LT8","LT9","LT10","LT11","LT12","LT13","LT14","LT15","MMSR2-1","MMSR2-2","MMSR2-3","MMSR3-1","MMSR3-4","MMSR3-5"],BIZ=["BIZ1-0201","BIZ1-0202","BIZ1-0203","BIZ1-0204","BIZ1-0205","BIZ1-0206","BIZ1-0301","BIZ1-0302","BIZ1-0303","BIZ1-0304","BIZ1-0305","BIZ1-0307","BIZ1-CMRI","BIZ1-SR6-1","BIZ1-SR6-4","BIZ2-0112","BIZ2-0114","BIZ2-0115","BIZ2-0116","BIZ2-0117","BIZ2-0118","BIZ2-0201","BIZ2-0202","BIZ2-0224","BIZ2-0226","BIZ2-0227","BIZ2-0228","BIZ2-0229","BIZ2-0301","BIZ2-0302","BIZ2-0303","BIZ2-0404","BIZ2-0413A","BIZ2-0413B","BIZ2-0413C","BIZ2-0420","BIZ2-0422","BIZ2-0509","BIZ2-0510","BIZ2-B104","LT18","LT19","SR@LT19","i3-0344","i3-0345","i3-0346","i3-0347","i3-Aud"],UT=["CAPT-DV","CAPT-SR1","CAPT-SR3","CAPT-SR4","CAPT-SR5","CAPT-SR6","ER2","ER3","ER6","ER7","ER8","ERC-ALR","ERC-GLR","ERC-SR1","ERC-SR10","ERC-SR11","ERC-SR2","ERC-SR3","ERC-SR4","ERC-SR8","ERC-SR9CAM","RC4-DV1","RC4-DV2","RC4-SR1","RC4-SR3","RC4-SR4","RC4-SR5","RC4-SR6","RH-SR","USP-DV","USP-MC","USP-MML","USP-SR1","USP-SR2","USP-SR3","USP-TR1","UT-AUD1","UT-AUD2","UT-AUD3","UTSRC-DA2","UTSRC-GLR","UTSRC-LT50","UTSRC-LT51","UTSRC-LT52","UTSRC-LT53","UTSRC-SR1","UTSRC-SR2","UTSRC-SR3","UTSRC-SR4","UTSRC-SR5","UTSRC-SR6","UTSRC-SR7","UTSRC-SR8","UTSRC-SR9","SR4-1","SR4-2","SR4-3","SR4-4","SR5-1","SR5-2","SR5-3","SR5-4","SR5-5","TC-SR3","TC-SR4","TC-SR5","TC-SR6","TLIAP","TP-ALR","TP-GLR","TP-SR10","TP-SR2","TP-SR3","TP-SR4","TP-SR5","TP-SR6","TP-SR7","TP-SR8","TP-SR9","Y-CompLab","Y-DV","Y-EC-CR15","Y-EC-CR17","Y-EC-GLRm1","Y-EC-GLRm2","Y-EC-PgRm1","Y-RC1-CR1","Y-RC1-CR3","Y-RC1-CR4","Y-RC1-CR5","Y-RC1-CR6","Y-RC1-CR7","Y-RC1-CR8","Y-RC1-Conf","Y-RC1-LT1","Y-RC2-CR11","Y-RC2-CR12","Y-RC2-CR13","Y-RC2-CR14","Y-RC2-CR9","Y-RC2-KCRm","Y-RC3-CR18","Y-RC3-CR19","Y-RC3-CR20","Y-RC3-CR21","Y-RC3-CR22","Y-RC3-CR23","YBlackBox","YIH-Paris","YIH-TR2","YIH-Tokyo","YLab1-Bio","YLab2AChem","YLab3-Phys","YLab4OChem","YPerfHall","YPracRoom6","YStudio1Dc","YStudio2GC"],OTHER=["CLB-0404","CLab","EXEC-SR","FMR","FST-Lab","HSSMLCR","ISS-DV","Innovation","LT3","LT4","LinELab","M14A&M14B","MLab","MM Study R","MPA","MT-Court","MicWLab","NAK-AUD","NGS-DV","OH","OTHCONFRM","POWERLAB","ProjLab",,"RMI-SR1","RS","RVRC SRD-D","RVRC-Resou","RVRC-SRB-D","RecS","SPSDryLab","SignalLab","TechHub","VCRm","WS2-0530","dRm1","dRm2","dRm3","dRm4","dRm5","dRmBLD1","undefined"],COM=["COM1-0113","COM1-0114","COM1-0120","COM1-0201","COM1-0202","COM1-0203","COM1-0204","COM1-0206","COM1-0207","COM1-0208","COM1-0209","COM1-0210","COM1-0212","COM1-0216","COM1-0217","COM1-0218","COM1-B101","COM1-B103","COM1-B108","COM1-B109","COM1-B110","COM1-B111","COM1-B112","COM1-B113","COM2-0108","CR2-1","CR2-2","CR3-3","CR3-4","CR3-5","CR3-6","CR3-7","CR4-1","CR4-2","CR5","LT16","LT17"],SCI=["CQT0315","CQT0318","LSLAB1&2","LSLAB3","LSLAB4","LSLAB5","LSLAB6","LSLAB7","LSLAB8","LSLAB9","LT20","LT21","LT22","LT24","LT25","LT26","LT27","LT31","LT32","LT33","LT34","MD1-05-01A","MD1-06-01A","MD1-07-01A","MD1-08-01E","MD1-09-01B","MD10-01-01","MD4-02-03E","MD7-02-03","MD9-0102GH","MD9-01Lab","S1-03CR","S11-0204","S11-0301","S11-0302","S11-0401","S12-0401","S12-0402","S12-0403","S13-0313","S13-M-08","S13-M-09","S14-04Lab","S14-0619","S14-0620","S15-0622","S16-0202","S16-0304","S16-0307","S16-0309","S16-03ALR","S16-0430","S16-0431","S16-0433","S16-0435","S16-0436","S16-0437","S16-0440","S16-05101","S16-05102","S16-0598","S16-06118","S16-SPS","S17-0302","S17-0304","S17-0404","S17-0405","S17-0406","S17-0512","S17-0611","S1A-0217","S2-0414","S2-0415","S3-05CR","S4-0103","S4-04Lab","S4A-01Lab","S4A-0308","S5-01GEN","S5-01PHY","S5-0223","S5-0224","S5-0225","S5-0410","S8-0203","S8-0314","S8-0403","S9-0513"],ENG=["DSALab","E1-04-09PC","E1-06-01","E1-06-02","E1-06-03","E1-06-04","E1-06-05","E1-06-06","E1-06-07","E1-06-08","E1-06-09","E1-06-10","E1-06-11","E1-06-12","E1-06-13","E1-06-14","E1-06-15","E1-06-16","E1A-0303","E1A-04-02","E2-03-02","E2-03-03","E2-03-32","E2-0306PC3","E2-0307PC4","E2-0308PC5","E2A-02-02","E2A-04-03","E3-0519ESP","E3-06-01","E3-06-02","E3-06-03","E3-06-04","E3-06-05","E3-06-06","E3-06-07","E3-06-08","E3-06-09","E3-06-10","E3-06-11","E3-06-12","E3-06-13","E3-06-14","E3-06-15","E3A-0502","E3A-0503","E3A-0504","E3A-0507","E4-02-01","E4-04-02","E4-04-03","E4-04-04","E4-04-07","E5-02-32","E5-03-19","E5-03-20","E5-03-21","E5-03-22","E5-03-23","EA-02-11","EA-04-27","EA-06-02","EA-06-03","EA-06-04","EA-06-05","EA-06-06","EA-06-07","EH-SR","EW2-0402","LT2","LT5","LT6","LT7","LT7A"],DUMMY=["DV-001","DV-002","DV-003","DV-004","DV-005","DV-008","DV-009","DV-CMS","DV-DMS","DV-EMS","DV-FMS","DV-HMS","DV-IMS","DV-JMS","DV-KMS","DV-LMS","DV-MMS","DV-NMS","DV1","DV2","DigELab","E-LAB"],LOCS=[SDE,AS,BIZ,UT,OTHER,COM,SCI,ENG],adjacency={};adjacency[SDE]=[SDE,ENG,DUMMY],adjacency[AS]=[AS,ENG,COM,DUMMY],adjacency[BIZ]=[BIZ,COM,DUMMY],adjacency[UT]=[UT,DUMMY],adjacency[OTHER]=[DUMMY],adjacency[COM]=[COM,AS,BIZ,DUMMY],adjacency[SCI]=[SCI,DUMMY],adjacency[ENG]=[ENG,SDE,AS];var App={addedModules:[],addedModuleNames:[],generatedSchedules:[],generatedScheduleVals:[],moduleList:[],blockedSlots:[]},deferred=$.Deferred();jQuery(document).ready(function(a){function b(b,c){var d=a(this);d.autoComplete({source:function(b,c){b=b.toLowerCase(),choices=App.moduleList;var d=[];a.each(choices,function(a,c){a.toLowerCase().indexOf(b)>=0?d.push([a,c]):c.toLowerCase().indexOf(b)>=0&&d.push([a,c])}),c(d)},minChars:3,delay:3,renderItem:function(a,b){b=b.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var c=a[0]+" "+a[1],d=new RegExp("("+b.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+a[0]+'">'+c.replace(d,"<b>$1</b>")+"</div>"},onSelect:function(a,b,c){ModuleUtil.prototype.addModule(b),d.val("")}}),a(this).keypress(function(a){var b=a.keyCode||a.which;13===b&&a.preventDefault()})}a.getJSON("json/moduleList.json",function(a){App.moduleList=a}),a("#modules_sortable").sortable({axis:"y",containment:"parent"}),a("#timetable_range_slider").slider({range:!0,min:0,max:28,step:1,values:[0,28],slide:function(b,c){if(c.values[0]>=c.values[1])return!1;var d=(a(".timetable tbody").outerWidth()-a(".timetable tbody td").position().left,c.values[0]),e=c.values[1],f=d/28*100,g=(28-e)/28*100;a(".blockout.start").width(f+"%"),a(".blockout.end").width(g+"%")}}),a("input[readonly], textarea[readonly]").click(function(b){a(this).select()}),a(".module_input").each(b),TimetableUtil.prototype.resetTimetable(),a(".makeOptimize").click(makeOptimizeClickHandler)});var ModuleUtil=function(){};ModuleUtil.prototype.getModNameByCode=function(a){return App.moduleList[a]},ModuleUtil.prototype.addModule=function(a){var b=ModuleUtil.prototype.getModNameByCode(a);App.addedModules.push(a),App.addedModuleNames.push(b),$("#modules_sortable").append('\n		<li class="ui-state-default module_item" data-code="'+a+'"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span>'+a+" "+b+'<a href="'+modCodeToNUSModsURL(a)+'" target="_blank"><i class="fa fa-info-circle"></i></a><a href="javascript:void(0);" class="remove_module"><i class="fa fa-times"></i></a></li>'),$("a.remove_module").unbind("click").click(moduleRemoveClickHandler),$(".modules p.info").hide()},ModuleUtil.prototype.removeModule=function(a){$.each(App.addedModules,function(b,c){return a==c?(App.addedModules.splice(b,1),!1):void 0}),$("#modules_sortable .module_item[data-code="+a+"]").unbind("click").remove(),0===App.addedModules.length&&$(".modules p.info").show()};var TimetableUtil=function(){};TimetableUtil.prototype.addBlockedSlot=function(a){return!a instanceof Time?!1:void App.blockedSlots.push(a)},TimetableUtil.prototype.removeBlockedSlot=function(a){return!a instanceof Time?!1:void $.each(App.blockedSlots,function(b,c){c.day===a.day&&c.start===a.start&&c.end===a.end&&App.blockedSlots.splice(b,1)})},TimetableUtil.prototype.toggleBlockedSlot=function(a){if(!a instanceof Time)return!1;var b=!1;$.each(App.blockedSlots,function(c,d){return d.day===a.day&&d.start===a.start&&d.end===a.end?(App.blockedSlots.splice(c,1),b=!0,!1):void 0}),b||App.blockedSlots.push(a)},TimetableUtil.prototype.addSchedule=function(a,b){App.generatedSchedules.push(a),App.generatedScheduleVals.push(b);for(var c="",d=0;d<App.generatedSchedules.length;d++)c+='<li><a href="javascript:void(0);" data-index="'+d+'">Schedule '+(d+1)+"</a></li>";$(".available_schedules").html(c),$(".available_schedules li a").unbind("click").click(populateScheduleClickHandler)},TimetableUtil.prototype.clearSchedules=function(){App.generatedSchedules=[],$(".available_schedules").html("")},TimetableUtil.prototype.resetTimetable=function(){for(var a=$(".timetable tbody"),b="",c=0;TIMETABLE_DAYS_SHOWN>c;c++){b+="<tr>",b+='<th class="day_label">'+DAYS_OF_WEEK[c]+"</th>";for(var d=0;TIMETABLE_RANGE>d;d++)b+="<td></td><td></td>";b+="</tr>"}a.html(b)},TimetableUtil.prototype.populateSchedule=function(a,b){TimetableUtil.prototype.resetTimetable(),$(".timetable tbody td").unbind("click").click(blockTableCellClickHandler),$.each(a.courses,function(a,b){$.each(b.activities,function(a,c){var d=c.slots[c.curSlot];TimetableUtil.prototype.addSlot(b,c.name,d)})}),$(".statistics .free_day").width(toPercent(b[1])),$(".statistics .breaks").width(toPercent(b[2])),$(".statistics .startend_time").width(toPercent(b[3])),$(".statistics .travel").width(toPercent(b[4]))},TimetableUtil.prototype.addSlot=function(a,b,c){$.each(c.timings,function(d,e){TimetableUtil.prototype.addBlock(a,b,c.code,e)})},TimetableUtil.prototype.addBlock=function(a,b,c,d){var e=$(".timetable tbody"),f=timeToColIndex(d.start),g=timeToColIndex(d.end),h=g-f,i=e.find("tr").eq(dayToRowIndex(d.day)),j=getCellInRow(i,f),k=makeBlock(a,b,c,d,getPaletteIndex(a.modCode));j.html(k);for(var l=[],m=f+1;g>m;m++){var n=getCellInRow(i,m);n&&l.push(n)}$.each(l,function(a,b){$(b).remove()}),j.prop("colspan",h)},Schedule.prototype.addCourse=function(a){this.courses.push(a)},Schedule.prototype.overlap=function(a){for(var b=0;b<this.blocked.length;b++)if(a.overlapTime(this.blocked[b]))return!0;for(var b=0;b<this.courses.length;b++)if("CS2020"==this.courses[b].modCode&&0==this.courses[b].activities[0].curSlot&&"ST2131"==a.modCode&&15==a.activities[1].curSlot,a.overlap(this.courses[b]))return!0;return!1},Schedule.prototype.clone=function(){var a=new Schedule;a.courses=[];for(var b=0;b<this.courses.length;b++)a.courses.push(this.courses[b].clone());return a.blocked=this.blocked,a},Course.prototype.hasNextSlot=function(){for(var a=0;a<this.activities.length;a++)if(this.activities[a].hasNextSlot())return!0},Course.prototype.nextSlot=function(){for(var a=0;a<this.activities.length;a++)if(this.activities[a].nextSlot()){for(var b=0;a>b;b++)this.activities[b].reset();return!0}},Course.prototype.overlap=function(a){for(var b=0;b<this.activities.length;b++)for(var c=0;c<a.activities.length;c++)if(this.activities[b].overlap(a.activities[c]))return!0;return!1},Course.prototype.overlapTime=function(a){for(var b=0;b<this.activities.length;b++)if(this.activities[b].overlapTime(a))return!0;return!1},Course.prototype.clone=function(){var a=new Course;a.modName=this.modName,a.modCode=this.modCode,a.activities=[];for(var b=0;b<this.activities.length;b++)a.activities.push(this.activities[b].clone());return a},Course.prototype.reset=function(){for(var a=0;a<this.activities.length;a++)this.activities[a].reset()},Activity.prototype.addSlot=function(a){for(var b=0;b<this.slots.length;b++)if(this.slots[b].code==a.ClassNo)return void this.slots[b].addTiming(a);this.slots.push(new Slot(a.ClassNo)),this.slots[this.slots.length-1].addTiming(a)},Activity.prototype.hasNextSlot=function(){return this.curSlot<this.slots.length-1},Activity.prototype.nextSlot=function(){return this.curSlot>=this.slots.length-1?!1:(++this.curSlot,!0)},Activity.prototype.overlap=function(a){return this.slots[this.curSlot].overlap(a.slots[a.curSlot])},Activity.prototype.overlapTime=function(a){return this.slots[this.curSlot].overlapTime(a)},Activity.prototype.clone=function(){var a=new Activity(this.name);return a.slots=this.slots,a.curSlot=this.curSlot,a},Activity.prototype.reset=function(){this.curSlot=0};var days={Monday:0,Tuesday:1,Wednesday:2,Thursday:3,Friday:4,Saturday:5,Sunday:6},weeks={"Every Week":0,"Odd Week":1,"Even Week":2};Slot.prototype.addTiming=function(a){this.timings.push(new Time(days[a.DayText],parseInt(a.StartTime),parseInt(a.EndTime),a.Venue,weeks[a.WeekText]))},Slot.prototype.overlap=function(a){for(var b=0;b<this.timings.length;b++)for(var c=0;c<a.timings.length;c++)if(this.timings[b].overlap(a.timings[c]))return!0;return!1},Slot.prototype.overlapTime=function(a){for(var b=0;b<this.timings.length;b++)if(this.timings[b].overlap(a))return!0;return!1},Time.prototype.overlap=function(a){return this.day!=a.day?!1:this.end<=a.start||this.start>=a.end?!1:this.overlapWeek(a)},Time.prototype.overlapWeek=function(a){if(0==this.week||0==a.week)return!0;if(!(1!=this.week&&2!=this.week||1!=a.week&&2!=a.week))return this.week==a.week;if("[object Array]"===Object.prototype.toString.call(this.week)&&"[object Array]"===Object.prototype.toString.call(a.week)){for(var b=0;b<this.week.length;b++)if(a.week.indexOf(-1!=this.week[b]))return!0;return!1}if("[object Array]"===Object.prototype.toString.call(this.week)||"[object Array]"===Object.prototype.toString.call(a.week)){var c,d;"[object Array]"===Object.prototype.toString.call(this.week)?(c=this.week,d=a.week%2):(c=a.week,d=this.week%2);for(var b=0;b<c.length;b++)if(c[b]%2==d)return!0;return!1}},Time.prototype.asString=function(){return["SUN","MON","TUE","WED","THU","FRI","SAT"][this.day]+" ("+this.start+"-"+this.end+")"};var modCache={},x;